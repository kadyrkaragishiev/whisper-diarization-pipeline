#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è whisper-diarization-pipeline"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Python
PYTHON_VERSION=$(python3 --version 2>&1 | grep -o "[0-9]\+\.[0-9]\+\.[0-9]\+")
MAJOR_VERSION=$(echo $PYTHON_VERSION | cut -d. -f1)
MINOR_VERSION=$(echo $PYTHON_VERSION | cut -d. -f2)

if [ "$MAJOR_VERSION" -lt 3 ] || [ "$MAJOR_VERSION" -eq 3 -a "$MINOR_VERSION" -lt 9 ]; then
    echo "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è Python 3.9+, –Ω–∞–π–¥–µ–Ω: $PYTHON_VERSION"
    exit 1
fi

echo "‚úÖ Python –≤–µ—Ä—Å–∏—è: $PYTHON_VERSION"

# –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
if [ ! -d "venv_py39" ]; then
    echo "üì¶ –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    python3 -m venv venv_py39
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîÑ –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
source venv_py39/bin/activate

# –û–±–Ω–æ–≤–ª—è–µ–º pip
echo "üì• –û–±–Ω–æ–≤–ª—è–µ–º pip..."
pip install --upgrade pip

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
pip install torch torchaudio --index-url https://download.pytorch.org/whl/cpu
pip install openai-whisper pyannote.audio transformers librosa soundfile pydub python-dotenv click tqdm matplotlib pandas numpy scipy

echo "‚úÖ –û–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!"
echo ""
echo "–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "source venv_py39/bin/activate"
echo ""
echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞:"
echo "python main.py input/audio.wav --model tiny" 