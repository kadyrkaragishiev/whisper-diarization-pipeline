# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π

## –ü—Ä–æ–±–ª–µ–º–∞
–î–∏–∞—Ä–∏–∑–∞—Ü–∏—è –±—ã–ª–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π PyAnnote. –ö–æ–¥ –∏—Å–∫–∞–ª –ª–æ–∫–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `models/pyannote/speaker-diarization-3.1`, –Ω–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ PyAnnote Audio –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `save_pretrained()` –∏ –º–æ–¥–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–µ—à–µ.

## –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑ –∫–µ—à–∞ PyAnnote –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ HuggingFace —Ç–æ–∫–µ–Ω–∞, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å —É–∂–µ –±—ã–ª–∞ —Å–∫–∞—á–∞–Ω–∞ —Ä–∞–Ω–µ–µ.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `main.py`:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –∫–µ—à–∞** –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:
```python
else:
    # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –∫–µ—à–∞ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
    print("üîÑ –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –∏–∑ –∫–µ—à–∞...")
    self.diarization_pipeline = Pipeline.from_pretrained(
        "pyannote/speaker-diarization-3.1"
    )
```

2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –∫–µ—à–∞** –¥–ª—è —Å–ª—É—á–∞–µ–≤ –±–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```python
# –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –∫–µ—à–∞ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ –Ω–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
try:
    print("üîÑ –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –∏–∑ –∫–µ—à–∞...")
    self.diarization_pipeline = Pipeline.from_pretrained(
        "pyannote/speaker-diarization-3.1"
    )
    # ...
except Exception as e:
    print(f"‚ö†Ô∏è  –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –∏–∑ –∫–µ—à–∞: {e}")
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

### –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ø—ã—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–∏:
1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å** (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `--local-models` –∏ –º–æ–¥–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
2. **–ö–µ—à PyAnnote** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –±–µ–∑ —Ç–æ–∫–µ–Ω–∞)
3. **HuggingFace —Å —Ç–æ–∫–µ–Ω–æ–º** (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```bash
# –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
./setup_env.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python 3.9+
source venv_py39/bin/activate

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å –¥–∏–∞—Ä–∏–∑–∞—Ü–∏–µ–π (–º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏–∑ –∫–µ—à–∞)
python main.py input/audio.wav --model tiny

# –ò–ª–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
python main.py input/audio.wav --model tiny --local-models models
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.9+ 
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `./setup_env.sh`)
- –ú–æ–¥–µ–ª—å PyAnnote –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫–∞—á–∞–Ω–∞ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑ (—á–µ—Ä–µ–∑ `download_models.py` –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å —Ç–æ–∫–µ–Ω–æ–º)

## –û—á–∏—Å—Ç–∫–∞
- –£–¥–∞–ª–µ–Ω–æ —Å—Ç–∞—Ä–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `venv` (Python 3.7), –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ –ø–∞–∫–µ—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `setup_env.sh` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ `venv_py39/` –≤ `.gitignore`

## –†–µ–∑—É–ª—å—Ç–∞—Ç
‚úÖ –î–∏–∞—Ä–∏–∑–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ HuggingFace —Ç–æ–∫–µ–Ω–∞, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å —É–∂–µ –µ—Å—Ç—å –≤ –∫–µ—à–µ
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Ç–∞–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–µ—à–∞
‚úÖ Graceful fallback –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ 

# üõ†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

## ‚ùó –û—à–∏–±–∫–∞ MPS –Ω–∞ Apple Silicon Mac

### –°–∏–º–ø—Ç–æ–º—ã:
- –û—à–∏–±–∫–∞: `Could not run 'aten::_sparse_coo_tensor_with_dims_and_tensors' with arguments from the 'SparseMPS' backend`
- –û—à–∏–±–∫–∞: `Could not run 'aten::empty.memory_format' with arguments from the 'SparseMPS' backend` 
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Whisper –Ω–∞ MPS (Apple Silicon GPU)

### ‚úÖ –†–µ—à–µ–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤ v20240930+):
–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ v20240930, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:
- –ü–∞–π–ø–ª–∞–π–Ω –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫—É MPS
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ CPU –¥–ª—è Whisper
- –î–∏–∞—Ä–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ MPS (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
- –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### üîß –†—É—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CPU –¥–ª—è Whisper
python main.py input/audio.wav --device cpu

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã
export WHISPER_DEVICE=cpu
``` 